<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Limn UDS 2.0 - SKU Generator Order Form</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .form-container {
            padding: 40px;
        }

        .basic-info {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .basic-info h3 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group input:disabled,
        .form-group select:disabled {
            background-color: #f5f5f5;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 0;
        }

        .tab {
            padding: 12px 24px;
            background: #f8f9fa;
            border: none;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            transition: all 0.3s ease;
            position: relative;
            bottom: -2px;
        }

        .tab:disabled {
            background: #e0e0e0;
            color: #999;
            cursor: not-allowed;
            opacity: 0.5;
        }

        .tab.active {
            background: white;
            color: #667eea;
            border: 2px solid #e0e0e0;
            border-bottom: 2px solid white;
        }

        .tab.active:disabled {
            background: #e0e0e0;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .material-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .material-section h4 {
            color: #667eea;
            margin-bottom: 20px;
        }

        .add-item-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 6px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .add-item-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .add-item-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .items-list {
            margin-top: 40px;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .items-list h3 {
            color: #667eea;
            margin-bottom: 20px;
        }

        .item-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .item-details h4 {
            color: #333;
            margin-bottom: 10px;
        }

        .item-specs {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .spec-badge {
            background: #667eea;
            color: white;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .remove-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .remove-btn:hover {
            background: #c82333;
        }

        .order-summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 8px;
            margin-top: 30px;
        }

        .order-summary h3 {
            margin-bottom: 20px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .summary-row:last-child {
            border-bottom: none;
            font-size: 1.3rem;
            font-weight: bold;
            margin-top: 10px;
        }

        .submit-section {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 6px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        .required {
            color: #dc3545;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Limn UDS 2.0 - SKU Generator</h1>
            <p>Create custom SKUs for client orders</p>
        </div>

        <div class="form-container">
            <!-- Basic Information Section -->
            <div class="basic-info">
                <h3>Basic Information</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="collection">Collection <span class="required">*</span></label>
                        <select id="collection" onchange="updateItems()">
                            <option value="">Select Collection</option>
                            <option value="UKIAH">Ukiah</option>
                            <option value="STHEL">St Helena</option>
                            <option value="PACIF">Pacifica</option>
                            <option value="INYO">Inyo</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="item">Item Type <span class="required">*</span></label>
                        <select id="item" disabled onchange="enableTabs()">
                            <option value="">Select Item</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="quantity">Quantity <span class="required">*</span></label>
                        <input type="number" id="quantity" min="1" value="1" disabled>
                    </div>

                    <div class="form-group">
                        <label for="price">Unit Price ($) <span class="required">*</span></label>
                        <input type="number" id="price" min="0" step="0.01" placeholder="0.00" disabled>
                    </div>
                </div>
            </div>

            <!-- Material Tabs -->
            <div class="tabs">
                <button class="tab active" id="tab-fabric" onclick="showTab('fabric')" disabled>Fabric</button>
                <button class="tab" id="tab-wood" onclick="showTab('wood')" disabled>Wood</button>
                <button class="tab" id="tab-metal" onclick="showTab('metal')" disabled>Metal</button>
                <button class="tab" id="tab-stone" onclick="showTab('stone')" disabled>Stone</button>
                <button class="tab" id="tab-additional" onclick="showTab('additional')" disabled>Additional Specs</button>
            </div>

            <!-- Tab Contents -->
            <div id="fabric-content" class="tab-content active">
                <div class="material-section">
                    <h4>Fabric Selection</h4>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="fabric-brand">Brand</label>
                            <select id="fabric-brand" onchange="updateFabricCollections()">
                                <option value="None">None</option>
                                <option value="Agora">Agora</option>
                                <option value="Sunbrella">Sunbrella</option>
                                <option value="Ateja">Ateja</option>
                                <option value="Vanja">Vanja</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="fabric-collection">Collection</label>
                            <select id="fabric-collection" onchange="updateFabricColors()" disabled>
                                <option value="">Select Collection</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="fabric-color">Color</label>
                            <select id="fabric-color" disabled>
                                <option value="">Select Color</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <div id="wood-content" class="tab-content">
                <div class="material-section">
                    <h4>Wood Selection</h4>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="wood-type">Wood Type</label>
                            <select id="wood-type">
                                <option value="None">None</option>
                                <option value="Oak">Oak</option>
                                <option value="Walnut">Walnut</option>
                                <option value="Maple">Maple</option>
                                <option value="Cherry">Cherry</option>
                                <option value="Ash">Ash</option>
                                <option value="Teak">Teak</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="wood-finish">Finish</label>
                            <select id="wood-finish">
                                <option value="None">None</option>
                                <option value="Natural">Natural</option>
                                <option value="Stained">Stained</option>
                                <option value="Lacquered">Lacquered</option>
                                <option value="Oiled">Oiled</option>
                                <option value="Painted">Painted</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <div id="metal-content" class="tab-content">
                <div class="material-section">
                    <h4>Metal Selection</h4>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="metal-type">Metal Type</label>
                            <select id="metal-type">
                                <option value="None">None</option>
                                <option value="Steel">Steel</option>
                                <option value="Aluminum">Aluminum</option>
                                <option value="Brass">Brass</option>
                                <option value="Copper">Copper</option>
                                <option value="Stainless">Stainless Steel</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="metal-finish">Finish</label>
                            <select id="metal-finish">
                                <option value="None">None</option>
                                <option value="Brushed">Brushed</option>
                                <option value="Polished">Polished</option>
                                <option value="Matte">Matte</option>
                                <option value="Powder-Coated">Powder Coated</option>
                                <option value="Anodized">Anodized</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <div id="stone-content" class="tab-content">
                <div class="material-section">
                    <h4>Stone Selection</h4>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="stone-type">Stone Type</label>
                            <select id="stone-type">
                                <option value="None">None</option>
                                <option value="Marble">Marble</option>
                                <option value="Granite">Granite</option>
                                <option value="Limestone">Limestone</option>
                                <option value="Travertine">Travertine</option>
                                <option value="Quartz">Quartz</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="stone-finish">Finish</label>
                            <select id="stone-finish">
                                <option value="None">None</option>
                                <option value="Polished">Polished</option>
                                <option value="Honed">Honed</option>
                                <option value="Leathered">Leathered</option>
                                <option value="Flamed">Flamed</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <div id="additional-content" class="tab-content">
                <div class="material-section">
                    <h4>Additional Specifications</h4>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="seat-depth">Seat Depth</label>
                            <select id="seat-depth">
                                <option value="">Standard</option>
                                <option value="18">18"</option>
                                <option value="20">20"</option>
                                <option value="22">22"</option>
                                <option value="24">24"</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="back-height">Back Height</label>
                            <select id="back-height">
                                <option value="">Standard</option>
                                <option value="Low">Low</option>
                                <option value="Medium">Medium</option>
                                <option value="High">High</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="arm-style">Arm Style</label>
                            <select id="arm-style">
                                <option value="">Standard</option>
                                <option value="Fixed">Fixed</option>
                                <option value="Adjustable">Adjustable</option>
                                <option value="None">No Arms</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="custom-dimension">Custom Dimension</label>
                            <input type="text" id="custom-dimension" placeholder="e.g., 28Fd">
                        </div>
                    </div>
                </div>
            </div>

            <button class="add-item-btn" onclick="addItem()" id="add-item-btn" disabled>Add Item to Order</button>

            <!-- Items List -->
            <div class="items-list" id="items-list" style="display: none;">
                <h3>Order Items</h3>
                <div id="items-container"></div>
            </div>

            <!-- Order Summary -->
            <div class="order-summary" id="order-summary" style="display: none;">
                <h3>Order Summary</h3>
                <div class="summary-row">
                    <span>Subtotal:</span>
                    <span id="subtotal">$0.00</span>
                </div>
                <div class="summary-row">
                    <span>Customization Charges:</span>
                    <span id="custom-charges">$0.00</span>
                </div>
                <div class="summary-row">
                    <span>Total:</span>
                    <span id="total">$0.00</span>
                </div>
            </div>

            <!-- Submit Section -->
            <div class="submit-section" id="submit-section" style="display: none;">
                <button class="btn btn-secondary" onclick="saveDraft()">Save as Draft</button>
                <button class="btn btn-primary" onclick="submitOrder()">Submit to SKU Board</button>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let orderItems = [];
        let currentTab = 'fabric';

        // Item data based on collection
        const itemsByCollection = {
            'UKIAH': [
                { value: 'UKIAH-001', text: 'Ukiah Lounge Chair', basePrice: 2500 },
                { value: 'UKIAH-002', text: 'Ukiah Sofa', basePrice: 4500 },
                { value: 'UKIAH-003', text: 'Ukiah Ottoman', basePrice: 1200 },
                { value: 'UKIAH-004', text: 'Ukiah Dining Chair', basePrice: 1800 }
            ],
            'STHEL': [
                { value: 'STHEL-001', text: 'St Helena Dining Table', basePrice: 5500 },
                { value: 'STHEL-002', text: 'St Helena Console', basePrice: 3200 },
                { value: 'STHEL-003', text: 'St Helena Bench', basePrice: 2200 }
            ],
            'PACIF': [
                { value: 'PACIF-001', text: 'Pacifica Bed Frame', basePrice: 4800 },
                { value: 'PACIF-002', text: 'Pacifica Nightstand', basePrice: 1500 },
                { value: 'PACIF-003', text: 'Pacifica Dresser', basePrice: 3500 }
            ],
            'INYO': [
                { value: 'INYO-001', text: 'Inyo Coffee Table', basePrice: 2800 },
                { value: 'INYO-002', text: 'Inyo Side Table', basePrice: 1200 },
                { value: 'INYO-003', text: 'Inyo Bookshelf', basePrice: 3200 }
            ]
        };

        // Fabric collections and colors data
        const fabricData = {
            'Agora': {
                collections: ['Canvas', 'Panama', 'Lisos'],
                colors: {
                    'Canvas': ['Black', 'Navy', 'Grey', 'Beige'],
                    'Panama': ['White', 'Cream', 'Sand', 'Charcoal'],
                    'Lisos': ['Blue', 'Green', 'Red', 'Yellow']
                }
            },
            'Sunbrella': {
                collections: ['Marine', 'Shade', 'Upholstery'],
                colors: {
                    'Marine': ['Pacific Blue', 'Navy', 'Captain Navy', 'Natural'],
                    'Shade': ['Charcoal', 'Silver', 'Toast', 'Black'],
                    'Upholstery': ['Canvas', 'Linen', 'Heritage', 'Spectrum']
                }
            },
            'Ateja': {
                collections: ['Premium', 'Classic'],
                colors: {
                    'Premium': ['Midnight', 'Pearl', 'Sage', 'Rust'],
                    'Classic': ['Ivory', 'Graphite', 'Camel', 'Forest']
                }
            },
            'Vanja': {
                collections: ['Modern', 'Traditional'],
                colors: {
                    'Modern': ['Storm', 'Cloud', 'Ash', 'Smoke'],
                    'Traditional': ['Burgundy', 'Olive', 'Tan', 'Navy']
                }
            }
        };

        // Initialize on page load
        window.onload = function() {
            checkForDraft();
        };

        // Update items based on collection
        function updateItems() {
            const collection = document.getElementById('collection').value;
            const itemSelect = document.getElementById('item');
            const quantityInput = document.getElementById('quantity');
            const priceInput = document.getElementById('price');
            
            itemSelect.innerHTML = '<option value="">Select Item</option>';
            itemSelect.disabled = !collection;
            quantityInput.disabled = !collection;
            priceInput.disabled = !collection;
            
            if (collection && itemsByCollection[collection]) {
                itemsByCollection[collection].forEach(item => {
                    const option = document.createElement('option');
                    option.value = item.value;
                    option.textContent = item.text;
                    option.dataset.price = item.basePrice;
                    itemSelect.appendChild(option);
                });
            }
            
            // Disable all tabs until item is selected
            disableAllTabs();
        }

        // Enable tabs when basic info is complete
        function enableTabs() {
            const item = document.getElementById('item').value;
            const quantity = document.getElementById('quantity').value;
            const price = document.getElementById('price').value;
            
            if (item) {
                // Set default price if not entered
                if (!price) {
                    const selectedOption = document.querySelector('#item option:checked');
                    if (selectedOption && selectedOption.dataset.price) {
                        document.getElementById('price').value = selectedOption.dataset.price;
                    }
                }
                
                // Enable all material tabs
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.disabled = false;
                });
                
                // Enable add item button if we have all required fields
                if (item && quantity && document.getElementById('price').value) {
                    document.getElementById('add-item-btn').disabled = false;
                }
            }
        }

        // Disable all tabs
        function disableAllTabs() {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.disabled = true;
            });
            document.getElementById('add-item-btn').disabled = true;
        }

        // Tab switching functionality
        function showTab(tabName) {
            // Don't switch if tab is disabled
            const tabButton = document.getElementById(`tab-${tabName}`);
            if (tabButton.disabled) return;
            
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(`${tabName}-content`).classList.add('active');
            
            // Add active class to selected tab
            tabButton.classList.add('active');
            
            currentTab = tabName;
        }

        // Update fabric collections based on brand
        function updateFabricCollections() {
            const brand = document.getElementById('fabric-brand').value;
            const collectionSelect = document.getElementById('fabric-collection');
            const colorSelect = document.getElementById('fabric-color');
            
            collectionSelect.innerHTML = '<option value="">Select Collection</option>';
            colorSelect.innerHTML = '<option value="">Select Color</option>';
            
            if (brand && brand !== 'None' && fabricData[brand]) {
                collectionSelect.disabled = false;
                fabricData[brand].collections.forEach(collection => {
                    const option = document.createElement('option');
                    option.value = collection;
                    option.textContent = collection;
                    collectionSelect.appendChild(option);
                });
            } else {
                collectionSelect.disabled = true;
                colorSelect.disabled = true;
            }
        }

        // Update fabric colors based on collection
        function updateFabricColors() {
            const brand = document.getElementById('fabric-brand').value;
            const collection = document.getElementById('fabric-collection').value;
            const colorSelect = document.getElementById('fabric-color');
            
            colorSelect.innerHTML = '<option value="">Select Color</option>';
            
            if (brand && collection && fabricData[brand] && fabricData[brand].colors[collection]) {
                colorSelect.disabled = false;
                fabricData[brand].colors[collection].forEach(color => {
                    const option = document.createElement('option');
                    option.value = color;
                    option.textContent = color;
                    colorSelect.appendChild(option);
                });
            } else {
                colorSelect.disabled = true;
            }
        }

        // Add item to order
        function addItem() {
            const collection = document.getElementById('collection').value;
            const itemSelect = document.getElementById('item');
            const item = itemSelect.value;
            const itemText = itemSelect.options[itemSelect.selectedIndex].text;
            const quantity = parseInt(document.getElementById('quantity').value);
            const price = parseFloat(document.getElementById('price').value);
            
            if (!collection || !item || !quantity || !price) {
                alert('Please fill in all required fields');
                return;
            }
            
            // Gather material selections
            const materials = {
                fabric: {
                    brand: document.getElementById('fabric-brand').value,
                    collection: document.getElementById('fabric-collection').value,
                    color: document.getElementById('fabric-color').value
                },
                wood: {
                    type: document.getElementById('wood-type').value,
                    finish: document.getElementById('wood-finish').value
                },
                metal: {
                    type: document.getElementById('metal-type').value,
                    finish: document.getElementById('metal-finish').value
                },
                stone: {
                    type: document.getElementById('stone-type').value,
                    finish: document.getElementById('stone-finish').value
                },
                additional: {
                    seatDepth: document.getElementById('seat-depth').value,
                    backHeight: document.getElementById('back-height').value,
                    armStyle: document.getElementById('arm-style').value,
                    customDimension: document.getElementById('custom-dimension').value
                }
            };
            
            // Generate SKU
            const sku = generateSKU(item, materials);
            
            // Create item object
            const orderItem = {
                id: Date.now(),
                collection,
                item,
                itemText,
                quantity,
                price,
                materials,
                sku,
                total: quantity * price
            };
            
            orderItems.push(orderItem);
            
            // Update display
            renderItems();
            updateSummary();
            
            // Show sections
            document.getElementById('items-list').style.display = 'block';
            document.getElementById('order-summary').style.display = 'block';
            document.getElementById('submit-section').style.display = 'flex';
            
            // Clear form for next item
            clearForm();
            
            // Show notification
            showNotification('Item added to order');
        }

        // Generate SKU based on selections
        function generateSKU(baseItem, materials) {
            let skuParts = [baseItem];
            
            // Add fabric if selected
            if (materials.fabric.brand !== 'None' && materials.fabric.brand) {
                skuParts.push(materials.fabric.brand.substring(0, 3).toUpperCase());
                if (materials.fabric.collection) {
                    skuParts.push(materials.fabric.collection.substring(0, 3).toUpperCase());
                }
                if (materials.fabric.color) {
                    skuParts.push(materials.fabric.color.substring(0, 3).toUpperCase());
                }
            }
            
            // Add wood if selected
            if (materials.wood.type !== 'None' && materials.wood.type) {
                skuParts.push(materials.wood.type.substring(0, 3).toUpperCase());
                if (materials.wood.finish !== 'None' && materials.wood.finish) {
                    skuParts.push(materials.wood.finish.substring(0, 3).toUpperCase());
                }
            }
            
            // Add metal if selected
            if (materials.metal.type !== 'None' && materials.metal.type) {
                skuParts.push(materials.metal.type.substring(0, 3).toUpperCase());
                if (materials.metal.finish !== 'None' && materials.metal.finish) {
                    skuParts.push(materials.metal.finish.substring(0, 3).toUpperCase());
                }
            }
            
            // Add stone if selected
            if (materials.stone.type !== 'None' && materials.stone.type) {
                skuParts.push(materials.stone.type.substring(0, 3).toUpperCase());
                if (materials.stone.finish !== 'None' && materials.stone.finish) {
                    skuParts.push(materials.stone.finish.substring(0, 3).toUpperCase());
                }
            }
            
            // Add custom dimension if specified
            if (materials.additional.customDimension) {
                skuParts.push(materials.additional.customDimension);
            }
            
            return skuParts.join('-');
        }

        // Render items list
        function renderItems() {
            const container = document.getElementById('items-container');
            container.innerHTML = '';
            
            orderItems.forEach((item, index) => {
                const itemCard = document.createElement('div');
                itemCard.className = 'item-card';
                
                const detailsHtml = `
                    <div class="item-details">
                        <h4>${item.itemText} (${item.quantity}x)</h4>
                        <p><strong>SKU:</strong> ${item.sku}</p>
                        <div class="item-specs">
                            ${item.materials.fabric.brand !== 'None' ? `<span class="spec-badge">Fabric: ${item.materials.fabric.brand}</span>` : ''}
                            ${item.materials.wood.type !== 'None' ? `<span class="spec-badge">Wood: ${item.materials.wood.type}</span>` : ''}
                            ${item.materials.metal.type !== 'None' ? `<span class="spec-badge">Metal: ${item.materials.metal.type}</span>` : ''}
                            ${item.materials.stone.type !== 'None' ? `<span class="spec-badge">Stone: ${item.materials.stone.type}</span>` : ''}
                        </div>
                    </div>
                    <div>
                        <p><strong>$${item.total.toFixed(2)}</strong></p>
                        <button class="remove-btn" onclick="removeItem(${index})">Remove</button>
                    </div>
                `;
                
                itemCard.innerHTML = detailsHtml;
                container.appendChild(itemCard);
            });
        }

        // Remove item from order
        function removeItem(index) {
            orderItems.splice(index, 1);
            renderItems();
            updateSummary();
            
            if (orderItems.length === 0) {
                document.getElementById('items-list').style.display = 'none';
                document.getElementById('order-summary').style.display = 'none';
                document.getElementById('submit-section').style.display = 'none';
            }
        }

        // Update order summary
        function updateSummary() {
            let subtotal = 0;
            let customCharges = 0;
            
            orderItems.forEach(item => {
                subtotal += item.total;
                
                // Add custom charges for premium materials
                if (item.materials.fabric.brand === 'Ateja' || item.materials.fabric.brand === 'Vanja') {
                    customCharges += item.quantity * 150;
                }
                if (item.materials.stone.type !== 'None') {
                    customCharges += item.quantity * 300;
                }
            });
            
            const total = subtotal + customCharges;
            
            document.getElementById('subtotal').textContent = `$${subtotal.toFixed(2)}`;
            document.getElementById('custom-charges').textContent = `$${customCharges.toFixed(2)}`;
            document.getElementById('total').textContent = `$${total.toFixed(2)}`;
        }

        // Clear form after adding item
        function clearForm() {
            document.getElementById('collection').value = '';
            document.getElementById('item').value = '';
            document.getElementById('item').disabled = true;
            document.getElementById('quantity').value = '1';
            document.getElementById('quantity').disabled = true;
            document.getElementById('price').value = '';
            document.getElementById('price').disabled = true;
            
            // Reset all material selections
            document.getElementById('fabric-brand').value = 'None';
            document.getElementById('fabric-collection').value = '';
            document.getElementById('fabric-collection').disabled = true;
            document.getElementById('fabric-color').value = '';
            document.getElementById('fabric-color').disabled = true;
            
            document.getElementById('wood-type').value = 'None';
            document.getElementById('wood-finish').value = 'None';
            
            document.getElementById('metal-type').value = 'None';
            document.getElementById('metal-finish').value = 'None';
            
            document.getElementById('stone-type').value = 'None';
            document.getElementById('stone-finish').value = 'None';
            
            document.getElementById('seat-depth').value = '';
            document.getElementById('back-height').value = '';
            document.getElementById('arm-style').value = '';
            document.getElementById('custom-dimension').value = '';
            
            // Disable tabs again
            disableAllTabs();
            
            // Reset to fabric tab
            showTab('fabric');
        }

        // Save draft to localStorage
        function saveDraft() {
            const draft = {
                items: orderItems,
                timestamp: new Date().toISOString()
            };
            
            localStorage.setItem('limnOrderDraft', JSON.stringify(draft));
            showNotification('Draft saved successfully');
        }

        // Check for existing draft
        function checkForDraft() {
            const draft = localStorage.getItem('limnOrderDraft');
            if (draft) {
                const draftData = JSON.parse(draft);
                const timestamp = new Date(draftData.timestamp).toLocaleString();
                
                if (confirm(`Found a draft from ${timestamp}. Would you like to load it?`)) {
                    orderItems = draftData.items;
                    renderItems();
                    updateSummary();
                    
                    if (orderItems.length > 0) {
                        document.getElementById('items-list').style.display = 'block';
                        document.getElementById('order-summary').style.display = 'block';
                        document.getElementById('submit-section').style.display = 'flex';
                    }
                }
            }
        }

        // Submit order to Supabase
        async function submitOrder() {
            if (orderItems.length === 0) {
                alert('Please add at least one item to the order');
                return;
            }
            
            try {
                // Initialize Supabase client
                const supabaseUrl = 'https://rwfgdtwbzkglfljyvgbt.supabase.co';
                const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ3ZmdkdHdiemtnbGZsanl2Z2J0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYwMDIwNjMsImV4cCI6MjA3MTU3ODA2M30.C3HRKtnQ_ivS7md7hJoOyusegbkusRCdhe5UonremY0';
                
                // Note: Replace with your actual Supabase credentials
                // const { createClient } = supabase;
                // const supabase = createClient(supabaseUrl, supabaseKey);
                
                // Prepare data for submission
                const skuRecords = orderItems.map(item => ({
                    custom_sku: item.sku,
                    base_item_id: item.item,
                    collection_id: item.collection,
                    fabric_brand: item.materials.fabric.brand !== 'None' ? item.materials.fabric.brand : null,
                    fabric_collection: item.materials.fabric.collection || null,
                    fabric_color: item.materials.fabric.color || null,
                    wood_type: item.materials.wood.type !== 'None' ? item.materials.wood.type : null,
                    wood_finish: item.materials.wood.finish !== 'None' ? item.materials.wood.finish : null,
                    metal_type: item.materials.metal.type !== 'None' ? item.materials.metal.type : null,
                    metal_finish: item.materials.metal.finish !== 'None' ? item.materials.metal.finish : null,
                    stone_type: item.materials.stone.type !== 'None' ? item.materials.stone.type : null,
                    stone_finish: item.materials.stone.finish !== 'None' ? item.materials.stone.finish : null,
                    additional_specs: item.materials.additional,
                    quantity: item.quantity,
                    unit_price: item.price,
                    total_price: item.total,
                    created_at: new Date().toISOString(),
                    status: 'pending'
                }));
                
                // Submit to Supabase (uncomment when Supabase is configured)
                // const { data, error } = await supabase
                //     .from('sku_master')
                //     .insert(skuRecords);
                
                // if (error) throw error;
                
                // For now, just show success message
                showNotification('Order submitted successfully!');
                
                // Clear draft
                localStorage.removeItem('limnOrderDraft');
                
                // Reset everything after 2 seconds
                setTimeout(() => {
                    orderItems = [];
                    renderItems();
                    updateSummary();
                    document.getElementById('items-list').style.display = 'none';
                    document.getElementById('order-summary').style.display = 'none';
                    document.getElementById('submit-section').style.display = 'none';
                }, 2000);
                
            } catch (error) {
                console.error('Error submitting order:', error);
                alert('Error submitting order. Please try again.');
            }
        }

        // Show notification
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Add event listeners for enabling add button
        document.getElementById('quantity').addEventListener('input', enableTabs);
        document.getElementById('price').addEventListener('input', enableTabs);
    </script>
</body>
</html>